# При публикации проекта Blazor использует Node.js

При публикации проекта, Blazor "под капотом" использует Node.js и JavaScript-код для трансляции IL-сборок в wasm-пакеты. При этом собирается не только код проекта, но и весь Runtime. Время сборки и количество ресурсов, которые при этом используются - значительные, на грани критических!

Причина, по которой используется JavaScript следующая (ChatGPT): tooling для трансляции IL в wasm разработан на TypeScript. TypeScript, как и C# - инструменты разработанные в Microsoft. В эко-системе TypeScript содержится огромная коллекция различных библиотек и инструментов, с помощью которых написать инструмент трансляции было проще всего. Т.е. более правильно говорить не о JavaScipt/Node.js, а о TypeScript и console-based Runtime (одним из вариантов которого является Node.js). Заметим, что мы имеем дело с транспайлером TypeScript -> JavaScript, результат которого осуществляет транспиляцию с IL в wasm.

Ещё одна причина использования Node.js - это развитая кросс-платформенная технология, которая работает на основных операционных системах (Windows/Linux/MacOS) "из коробки".

Важно понимать, что JavaScript - это основной механизм interop для wasm с браузером, т.е. избежать использования JavaScript в любом случае невозможно, а трансляция IL в wasm - лишь добавляет ещё один пункт в примерах совместного использования.

Для того, чтобы предотвратить повторную полную сборку проекта, необходимо использовать ключ `--no-build`:

```shell
dotnet publish --no-build
```

Этот ключ нельзя использовать безусловно, т.е. требуется добавить настройку "Полной пересборки" проекта, как опцию сборки в DevOps Pipeline. Также эта настройка может повлиять и на другие особенности DevOps Pipeline, например, придётся решать проблему с автоматической очисткой папки сборки проекта, а также выбора машины для сборки проекта.

Также возможен вариант, в котором скрипт сборки проекта (.csproj) собирает приложение без Runtime, а для сборки Runtime используется другой проект. Однако, этот вариант относится в Advanced-техникам, он сложнее в реализации и не исключает расхождения в совместимости приложения и Runtime.

## Гипотеза о том, почему так получилось

Следует заметить, что TypeScript был разработан в Microsoft, как внутренний инструмент для переноса приложений Office в web. Задача, которую выполняет транспайлер TypeScript - компиляция кода из одного языка программирования в другой. Т.е. развивая экосистему TypeScript, Microsoft разработал огромное количество библиотек для портирования одного языка в другой. Решение использовать эти библиотеки для схожей задачи преобразования из IL в wasm - имеет смысл.

Первоначально транспайлер TypeScript, вероятно был разработан на JavaScript, для которого в качестве Runtime использовался Node.js. Использование JavaScript в данном случае кажется разумным - поскольку трансляция кода осуществляется в JavaScript, почему бы не использовать эту же экосистему и для процесса трансляции. Это кажется некоторым вариантом dogfooding-а ты пользуешься тем же языком, для которого генерируешь исходный код. Использование Node.js в качестве Runtime тоже кажется разумным по следующим причинам:

- кросс-платформенность. Node.js прекрасно работает под Linux, Windows и MacOS. Его легко портировать и на другие операционные системы
- по состоянию на начало разработки TypeScript, других полноценных альтернатив не было. Deno появился существенно позже, а Bun приблизился к зрелости только в 2024 году

Важно понимать, что у Microsoft не очень хорошо получается с кросс-платформенностью. У них крайне сложно получалось создавать среды исполнения приложений для платформ отличных от Windows:

- WPF - только Windows
- .NET Framework - только Windows. .NET Core - вырос из разработки сторонней компании и изначально назывался Mono
- Avalonia - развитие идей WPF для Linux/MacOS/Windows - сторонний open-source продукт
- Компиляторы MSVC (C/C++) - только Windows

Выбор стороннего инструмента для разработки кросс-платформенного компилятора TypeScript - сейчас это кажется просто безальтернативным решением. И в 2025 году мало, что поменялось - Microsoft переписывает транспайлер TypeScript на Go. Для справки - разработчиком golang является Google.

>Go - это аллюзия на Google? Взяли первые две буквы названия компании для названия языка программирования?

Эта гипотеза поднимает серьёзные вопросы к качеству Blazor, т.к. "под капотом" находится целая куча устаревших технологий, с непонятными перспективами.
