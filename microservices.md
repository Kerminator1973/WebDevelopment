# Микро-сервисная архитектура

Термин **микро-сервисы** впервые появился в 2011 году. В 2014 году Martin Fowler и James Lewis опубликовали  [статью "Microservices"](https://martinfowler.com/articles/microservices.html). Эта статья быстро стала стандартом де-факто для разработчиков микро-сервисных архитектур.

Характеристики (атрибуты) микро-сервисов:

- Componentization via Services
- Organized Around Business Capabilities
- Products not Projects
- Smart Endpoints and Dumb Pipes
- Decentralized Governance
- Decentralized Data Management
- Infrastructure Automation
- Design for Failure
- Evolutionary Design

## Componentization via Services

Модульный дизайн – это всегда хорошая идея.

Компоненты – это части, которые при совмещении (*composed together*) образуют программное обеспечение. Каждый компонент отвечает за специфическую функцию системы.

В микро-сервисах предпочтительным является использование _Services_, а не _Libraries_. При этом, внутри самого сервиса могут быть использованы библиотеки. Важно то, что сущность, рассматриваемая как **компонент системы** должна быть сервисом, а не библиотекой.

## Organized Around Business Capabilities

В традиционных проектах команды имеют горизонтальную ответственность: пользовательский интерфейс, API, базы данных, бизнес-логику, и т.д. В монолитных приложениях чаще сего именно такое разделение даёт максимальных эффект.

Но в микро-сервисной архитектуре сервисы строятся вокруг бизнес-потребностей. Сервис решает какую-то конкретную особенность и разрабатывается одной командой, которая отвечает за все аспекты сервиса (пользовательский интерфейс, API, базы данных, бизнес-логику).

Ключевой вопрос: как мы понимаем, что вот здесь один сервис заканчивается и начинается другой? В микро-сервисной архитектуре мы идём от **business capabilities**. Например, в бизнесе есть разные бизнес-процессы: логистика, управление корзиной покупок, доставка товара клиентам, сопровождение клиентов – именно они и определяют границы сервисов.

## Products not Projects

В традиционных проектах, целью является доставка заказчикам работающего кода. Вовлечённость бизнеса в процесс разработки является минимальной (_no lasting relationship with the customer_). Обычно с клиентами общается только project manager и аналитик. Часто, после выпуска продукта, проектная команда уходит по другим проектам и больше не работает в бизнес-направлении.

В микро-сервисной архитектуре целью является доставка заказчикам работающего продукта. Если код оказывается менее элегантным, но это приводит к лучшему продукту, то так и должно быть.

Продукт должен сопровождаться и требует близкого взаимодействия с заказчиком всех членов команды.
Команда отвечает за микро-сервис после того, как он передан заказчику.

Werner Vogels, AWS CTO: "_You build it, you run it_".

## Smart Endpoints and Dumb Pipes

Микро-сервисы используют уже существующие web-протоколы (http/https). Часто используется REST API. В последние годы также активно используются такие протоколы как **GraphQL** и **gRPC**.

## Decentralized Governance

В микро-сервисах каждая команда принимает свои собственные решения по каждому из пунктов. Каждая команда полностью отвечает за свой сервис: "_You build it, you run it_". Этот подход позволяет принимать для каждого сервиса оптимальные технические решения. Это представляется возможным благодаря природе микро-сервисов со слабыми связями.

## Decentralized Data Management

В традиционных системах используется одна база данных, в которой все компоненты хранят свои данные.

В микро-сервисах каждый сервис имеет свою собственную базу данных. Говоря про разные базы данных, в первую очередь имеются в виду разные типы баз данных: SQL, NoSQL, кэширующие, in-memory, и т. д.

Самая большая проблема микро-сервисной архитектуры – это распределённые транзакции. Они требуют применения специализированных сложных алгоритмов синхронизации состояний и обеспечения транзакционности, что критически усложняет систему.

Дублирование данных – это всегда плохая идея.

Вы, как архитектор не должны настаивать на жёстком следовании данному принципу - он наиболее противоречивый из всех принципов микро-сервисной архитектуры.


