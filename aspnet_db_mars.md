# Параметр подключения к Microsoft SQL Server - MultipleActiveResultSets

Назначение параметра MultipleActiveResultSets - разрешить выполнение нескольких активных наборов результатов (например, нескольких SELECT) в рамках одного соединения. Параметр используется в строке подключения к СУБД Microsoft SQL Server и может выглядеть так:

```
MultipleActiveResultSets=true
```

**Когда нужен**: при работе с вложенными запросами, курсорами, или когда требуется параллельно читать данные из нескольких результирующих наборов.

**Ограничения**: не все драйверы поддерживают MARS; может снижать производительность при интенсивном использовании.

При миграции приложения с .NET Core 2.2 на .NET Core 3.1, без активации MARS не удаётся выполнить аутентификацию пользователя.

## Причины проблемы

В .NET Core 3.1 произошли изменения в работе с базами данных, включая обновления в Entity Framework Core и SqlClient. Это могло повлиять на сценарии, где одновременно выполнялись несколько операций с базой данных в рамках одного соединения. MARS позволяет выполнять несколько активных наборов результатов в одном соединении, что иногда необходимо при сложных операциях с данными, включая аутентификацию. 

Например, если в процессе аутентификации выполнялись несколько запросов к базе данных (например, проверка пользователя и получение его ролей), в .NET Core 3.1 без включённого MARS это могло привести к ошибкам. В .NET Core 2.2 такое могло работать без явного включения MARS из-за особенностей реализации.

В более новых версиях .NET (например, .NET 5, .NET 6 и последующих) были внесены дополнительные изменения в работу с базами данных и Entity Framework Core. Некоторые проблемы, связанные с MARS и аутентификацией, могли быть устранены в этих версиях, но это нужно проверять.
