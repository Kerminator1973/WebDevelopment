# Контейнеризация

Понятие **Linux контейнер** стадартизовано организацией Open Container Initiative [OCI](https://opencontainers.org/) и определено как "стандартная единица программного обеспечения, которая упаковывает код и его зависимости таким образом, чтобы программное обеспечение могло работать быстро и надёжно на разных компьютерах".

Предположим, что у нас есть Node.js-код:

```js
import { createServer } from 'http';
import { hostname } from 'os';

const version = 1;
const server = createServer((req, res) => {
    let i = 1e7; while (i > 0) { i--;};
    res.end(`Hello from ${hostname()} (v${version})`);
});
server.listen(8080);
```

Для того, чтобы запустить этот код, нам нужен файл "package.json".

Мы можем разработать специальный скрипт для [Docker](https://www.docker.com/) и сохранить его в специальный файл "Dockerfile":

```docker
FROM node:14-alpine
EXPOSE 8080
COPY app.js package.json /app/
WORKDIR /app
CMD ["npm", "start"]
```

Этот файл даёт Docker-у указания:

- использовать образ "node:14-alpine" в качестве базового
- использовать порт 8080 для доступа к приложению внутри контейнера
- скопировать из текущей машины в контейнер файлы app.js и package.json (в папку /app)
- использовать папку /app контейнера в качестве рабочей
- после запуска контейнера запустить в нём команду `npm start`

Собрать Docker-образ можно командой `docker build .`

В логе сборки будет указан идентификатор образа, который можно использовать для его запуска, например: "bb3bd34bac55". Соответственно, запустить этот образ можно командой:

```shell
docker run -it -p 8080:8080 bb3bd34bac55
```

Чтобы не мучаться с чифровыми идентификатороми образов, мы можем указать имя образа явным образом, например:

```shell
docker build -t hello-web:v1 .
docker run -it -p 8080:8080 hello-web:v1
```

Обычно используется не один контейнер, а группа контейнеров, работающих совместно (см. Docker Compose). Конейнер представляет собой песочницу и не может получать неконтролируемый доступ к ресурсам хостовой операционной системы. Также другие контейнеры не могут получать неконтролируемый доступ к данным контейнера, т.е. контейнер является изолированной песочницей.

## Kubernetes

Kubernetes - средства оркестрации контейнерами, выполняет следующие действия:

- позволяет объединять множество nodes в один логический кластер, добавлять и удалять nodes динамически, без влияния на общую работоспособность кластера
- гарантирует, что система будет всегда доступна. Если конкретный контейнер становится недоступен, Kubernetes перезапускает его
- предоставляет функционал service discovery и load balancing
- предоставляет доступ к хранилищам данных (persistances)
- автоматически обновляет программное обеспечение и позволяет откатиться на предыдущую версию без downtime
- предоставляет хранилище секретов и чувствительных данных, а также соответствующую систему управления
